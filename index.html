<!DOCTYPE html>
<html>
<head>
   <title>Peru Time Series</title>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
   <style>
       body { padding: 20px; }
       .container { width: 80%; margin: 0 auto; }
       h1 { text-align: center; font-size: 2.5em; margin-bottom: 30px; color: #333; }
   </style>
</head>
<body>
   <h1>Household Income Over Time (y_HH)</h1>
   <select id="regionSelect"></select>
   <div class="container">
       <canvas id="chart"></canvas>
   </div>
   <script>
       let chart;
       
       fetch('input.csv')
           .then(r => r.text())
           .then(csvText => {
               const data = Papa.parse(csvText, {
                   header: true,
                   dynamicTyping: true
               }).data;

               const regions = [...new Set(data.map(d => d.department))];
               const select = document.getElementById('regionSelect');
               regions.forEach(region => {
                   const option = document.createElement('option');
                   option.value = region;
                   option.text = region;
                   select.appendChild(option);
               });

               const ctx = document.getElementById('chart');
               chart = new Chart(ctx, {
                   type: 'line',
                   options: {
                       responsive: true,
                       interaction: {
                           mode: 'index'
                       }
                   }
               });

               function updateChart(region) {
                   const filteredData = data.filter(d => d.department === region);
                   chart.data = {
                       labels: filteredData.map(d => d.year),
                       datasets: [{
                           label: region,
                           data: filteredData.map(d => d.y_HH),
                           borderColor: '#4e79a7'
                       }]
                   };
                   chart.update();
               }

               select.onchange = (e) => updateChart(e.target.value);
               updateChart(regions[0]);
           });
   </script>
</body>
</html>
