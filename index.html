<!DOCTYPE html>
<html>
<head>
    <title>Peru Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0"></script>
</head>
<body>
    <div id="root"></div>
    <select id="regionSelect"></select>
    <div id="chart"></div>
    <script>
        // Load and parse data
        fetch('input.csv')
            .then(response => response.text())
            .then(csvText => {
                const data = Papa.parse(csvText, {
                    header: true,
                    dynamicTyping: true
                }).data;
                createVisualization(data);
            });

        function createVisualization(data) {
            const regions = [...new Set(data.map(d => d.department))];
            const select = document.getElementById('regionSelect');
            regions.forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.text = region;
                select.appendChild(option);
            });

            function updateChart(region) {
                const filteredData = data.filter(d => d.department == region);
                const trace = {
                    x: filteredData.map(d => d.year),
                    y: filteredData.map(d => d.y_HH),
                    type: 'scatter'
                };
                Plotly.newPlot('chart', [trace]);
            }

            select.onchange = (e) => updateChart(e.target.value);
            updateChart(regions[0]);
        }
    </script>
</body>
</html>
