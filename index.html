<!DOCTYPE html>
<html>
<head>
    <title>Peru Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0"></script>
    <style>
        #chart { width: 800px; height: 400px; }
    </style>
</head>
<body>
    <select id="regionSelect"></select>
    <canvas id="chart"></canvas>
    <script>
        let chart;
        fetch('input.csv')
            .then(response => response.text())
            .then(csvText => {
                const data = Papa.parse(csvText, {
                    header: true,
                    dynamicTyping: true
                }).data;
                createVisualization(data);
            });

        function createVisualization(data) {
            const regions = [...new Set(data.map(d => d.department))];
            const select = document.getElementById('regionSelect');
            regions.forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.text = region;
                select.appendChild(option);
            });

            const ctx = document.getElementById('chart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                options: {
                    animation: false,
                    responsive: true
                }
            });

            function updateChart(region) {
                const filteredData = data.filter(d => d.department == region);
                chart.data = {
                    labels: filteredData.map(d => d.year),
                    datasets: [{
                        label: 'Region ' + region,
                        data: filteredData.map(d => d.y_HH),
                        borderColor: '#4e79a7'
                    }]
                };
                chart.update('none');
            }

            select.onchange = (e) => updateChart(e.target.value);
            updateChart(regions[0]);
        }
    </script>
</body>
</html>
